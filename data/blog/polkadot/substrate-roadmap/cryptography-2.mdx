
---
title: Substrate Roadmap - Cryptography part 2 - Seeds, Mnemonic, Addresses, and Keys

date: 2024-01-17

authors: ['nhan-dnguyen']

tags: ['technical', 'blockchain']

draft: false

summary: High level concept - Cryptography part 2 - Mnemonic, Seeds, Addresses, and Keys

---

This article is a part of the Substrate Roadmap series. <br />

# Seeds and Mnemonic

Mnemonic and seed are the representations of a private key. <br />
**Seeds are secrets!** <br />
**Mnemonics (Mnemonic phrase/Seed phrase) usually include 12 or 24 words.** <br />

## Why do we need Mnemonic?

The private key usually is a long random string, and it's represented in binary display format (base64, base32, ...) <br />
It's hard to remember, and it's hard to type when we want to use private key, example for recovery. So we need another ways to represent the private key as a human readable format. <br />  

## How to generate Mnemonic?

There are many ways to generate Mnemonic. The most popular way is to use BIP39 (Bitcoin Improvement Proposal) standard. <br />
The BIP39 includes a wordlist of 2048 words, and the mnemonic's word will be choose from that list. Each word is represented by a number from 1 to 20148. <br />
In the binary display format, we need 11 bits to represent number (from 0 to 2047).
We will go through the steps to generate 12 words Mnemonic pharse with BIP39 standard. <br />

### Step 1: Generate 128 bits random number (called **entropy**)
- Example: `11011010010000101100101111001001110010000111111000010010100000001100001101001100101001011110011111001000010001010110000101111111`
- 128 bits long required for 12 words Mnemonic pharse, and 256 bits long required for 24 words Mnemonic pharse

### Step 2: Calculate the checksum
- From the random entropy above, we want to generate a list of 12 words. Remember we need 11 bits to represent a word, so we need 11 * 12 = 132 bits. But we only have 128 bits long entropy, so we still need 4 bits more. We called that 4 bits is the checksum.
- > A checksum is a number with the purpose of detecting errors in a set of data.
- To calculate the checksum, we need to hash the entropy with SHA256 - the hash function is used in BIP39 standard. The checksum is the first 4 bits of the hash result.
```
echo 11011010010000101100101111001001110010000111111000010010100000001100001101001100101001011110011111001000010001010110000101111111 | shasum -a 256 -0
// result: ced25fa131e86640ffc9517b590f84877e40ad20f7f1ae88707ec79945d0d454 ^-
```
- The checksum is `c` in hexadecimal, and `1100` in binary (the first 4 bits of the hash result)

### Step 3: Combine the entropy and the checksum

- Put the checksum to the end of the entropy, and we have 132 bits long data. We will split that data into 12 groups, each group has 11 bits long. Each group will be represented by a number from 0 to 2047. That number will be used to choose the word from the wordlist by plus 1.

11011010010 = 1746 (+1) = 1747 = surge
- Same as above we have the matching word for each group:
178+1 = 179 = bind <br />
1939+1 = 1940 = venue <br />
1159+1 = 1160 = movie <br />
1801+1 = 1802 = thrive <br />
515+1 = 516 = document <br />
105+1 = 106 = artwork <br />
1189+1 = 1190 = net <br />
1854+1 = 1855 = treat <br />
529+1 = 530 = drama <br />
706+1 = 707 = flame <br />
2044+1 = 2045 = zebra <br />

- So the Mnemonic pharse is: `surge bind venue movie thrive document artwork net treat drama flame zebra`

### Step 4: Generate the seed from the Mnemonic pharse
- The seed is generated by hashing the Mnemonic pharse with PBKDF2 (Password-Based Key Derivation Function 2) with HMAC-SHA512 as the pseudo-random function. 
- The iteration count is 2048, and the length of the derived key is 512 bits (64 bytes).

# Addresses

## What is Address?

Address is the representation of a public key. <br />

## How to generate Address?

### Step 1: Generate the public key from the private key
- The public key is generated by using Elliptic Curve Digital Signature Algorithm (ECDSA) with the private key as the input.
- The ECDSA is a cryptographic algorithm used by Bitcoin to ensure that funds can only be spent by their rightful owners.

### Step 2: Generate the address from the public key
- The address is generated by hashing the public key with Keccak-256 (SHA-3) hash function.

In Substrate, the address is base58 encoded, and includes a checksum and some context information. It's 2 bytes of context and 2 bytes of checksum.

# Key Derivation

In cryptography, key derivation is the process of generating one or more secret keys from a secret value. <br />
It usually called **key derivation function** (KDF). <br />
We have 2 types of KDF: **Hard derivation** and **Soft derivation**. <br />

## Hard derivation

Hard derivation derives new child keys from parent (private) keys. <br />
The child keys are not related to each other, and not reveal any information about the parent keys. <br />
**How to generate child keys from parent keys? **<br />
- We need a **path**. It's a data like name, index, ...
- Concentrate the parent key and the path, and hash it for a new child key.


## Soft derivation

Soft derivation derives new child keys from parent (public) keys. <br />
Different from hard derivation, the child keys are related to each other, and reveal information about the parent keys. Or on other words, all keys are related. <br />

# Subkey

Subkey is a command line tool to generate Mnemonic, Seed, Address. It also can use to sign and verify a message (verify digital signature). <br />

## How to install and try Subkey?

```bash
cargo install --force subkey --git https://github.com/paritytech/substrate --version ^3.0 --locked
#  reopen the terminal to use the CLI
subkey --version
subkey generate
# Output
#  Secret phrase:       elegant path spoon insect filter affair evidence bounce olympic champion detail client
#   Network ID:        substrate
#   Secret seed:       0xb14d86ff7f81cf1ca497c09f43845920128ccf75dd5ae4e89ece6d96ddcec73d
#   Public key (hex):  0x2e4a94528dbe47acebacefbe7da775836a726fcffeb2b393d200839030f7e914
#   Account ID:        0x2e4a94528dbe47acebacefbe7da775836a726fcffeb2b393d200839030f7e914
#   Public key (SS58): 5D7QDQ3DJjDKTnMTcJ1iSeb8ATQaTh8JGk7MrV3J5EHTTLPL
#   SS58 Address:      5D7QDQ3DJjDKTnMTcJ1iSeb8ATQaTh8JGk7MrV3J5EHTTLPL

# Sign message
echo -n 'Hello World' | subkey sign --suri 'elegant path spoon insect filter affair evidence bounce olympic champion detail client'
# Output: 0xf242d67c0a4a8e8f43ad2da89daf2c31a6aca6305263c9097a4a5b65a4a56143673e6e3c22218149f47c2173087c8ccda540785254207c87e7b5e510a6d1c28f

# Verify message
echo -n 'Hello World' | subkey verify '0xf242d67c0a4a8e8f43ad2da89daf2c31a6aca6305263c9097a4a5b65a4a56143673e6e3c22218149f47c2173087c8ccda540785254207c87e7b5e510a6d1c28f' '5D7QDQ3DJjDKTnMTcJ1iSeb8ATQaTh8JGk7MrV3J5EHTTLPL'                                     
# Output: Signature verifies correctly.

# Change the last character of the address
echo -n 'Hello World' | subkey verify '0xf242d67c0a4a8e8f43ad2da89daf2c31a6aca6305263c9097a4a5b65a4a56143673e6e3c22218149f47c2173087c8ccda540785254207c87e7b5e510a6d1c28f' '5D7QDQ3DJjDKTnMTcJ1iSeb8ATQaTh8JGk7MrV3J5EHTTLPE'
# Error: InvalidUri(Invalid checksum)

# Hard Key Derivation by add 2 slashes + path + // + index
subkey inspect 'elegant path spoon insect filter affair evidence bounce olympic champion detail client//derived-hard-key//0'
# Secret Key URI `elegant path spoon insect filter affair evidence bounce olympic champion detail client//derived-hard-key//0` is account:
#   Network ID:        substrate 
#  Secret seed:       0x6787be9358b75f05fce5aefcac0630c0bbf6d471d1dafdcd37a713de2b8ff8fd
#   Public key (hex):  0xe66b992283c82be00fa3d40c3c00990de44903bb08e95fa830a5028e84ea8541
#   Account ID:        0xe66b992283c82be00fa3d40c3c00990de44903bb08e95fa830a5028e84ea8541
#   Public key (SS58): 5HGpqKm1EXG7b2hienfsqBWgtH6dCJpz9aPG7mS5pTMZwxHh
#   SS58 Address:      5HGpqKm1EXG7b2hienfsqBWgtH6dCJpz9aPG7mS5pTMZwxHh

# Soft key derivation by add 1 slash + path + / + index
subkey inspect 'elegant path spoon insect filter affair evidence bounce olympic champion detail client/derive-soft-key/0'   
# Secret Key URI `elegant path spoon insect filter affair evidence bounce olympic champion detail client/derive-soft-key/0` is account:
#   Network ID:        substrate 
#  Secret seed:       n/a
#   Public key (hex):  0xc07596b0bbd9a2ac6c848dba5f43db08ca38c3a2e654da68a665f37c4ce02943
#   Account ID:        0xc07596b0bbd9a2ac6c848dba5f43db08ca38c3a2e654da68a665f37c4ce02943
#   Public key (SS58): 5GR3yvBosYrLELQwcna7cVKdqDAYGqFtV991V4ZtzrvwmbSc
#   SS58 Address:      5GR3yvBosYrLELQwcna7cVKdqDAYGqFtV991V4ZtzrvwmbSc
```


## Conclusion

TIL: 
- Mnemonic, seed and how to generate them
- Address and how to generate it
- Key derivation and the difference between hard derivation and soft derivation
- Subkey CLI tool and how to use it
